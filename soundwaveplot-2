# !pip install librosa matplotlib numpy

import librosa
import matplotlib.pyplot as plt
import numpy as np
import os

# === ãƒ•ã‚©ãƒ«ãƒ€æŒ‡å®š ===
folder1 = 'sounddata'
folder2 = 'sounddata2'

# === å¯¾å¿œã™ã‚‹WAVãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ï¼ˆã‚½ãƒ¼ãƒˆã—ã¦é †åºå¯¾å¿œï¼‰ ===
files1 = sorted([f for f in os.listdir(folder1) if f.lower().endswith('.wav')])
files2 = sorted([f for f in os.listdir(folder2) if f.lower().endswith('.wav')])

# ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèª
if len(files1) != len(files2):
    raise ValueError("âŒ ãƒ•ã‚©ãƒ«ãƒ€å†…ã®WAVãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“")

# === å„ãƒšã‚¢ã«å¯¾ã—ã¦å‡¦ç† ===
for i, (f1, f2) in enumerate(zip(files1, files2)):
    path1 = os.path.join(folder1, f1)
    path2 = os.path.join(folder2, f2)

    fig, axes = plt.subplots(2, 1, figsize=(12, 8), sharex=True)

    for idx, (wav_path, ax, label) in enumerate(zip([path1, path2], axes, ['sounddata', 'sounddata2'])):
        y, sr = librosa.load(wav_path, sr=None)

        # ğŸ”¸4ç§’ä»¥é™ã®åˆ‡ã‚Šå‡ºã—ï¼ˆã“ã“ã‚’å¤‰æ›´ï¼‰
        start_sample = int(sr * 4)
        y_trimmed = y[start_sample:] if len(y) > start_sample else np.array([])
        time = np.linspace(4, 4 + len(y_trimmed) / sr, num=len(y_trimmed))

        if len(y_trimmed) > 0:
            ax.plot(time, np.abs(y_trimmed), color='blue', linewidth=1)
        ax.set_title(f'Magnitude vs. Time ({label}/{os.path.basename(wav_path)})', fontsize=14)
        ax.set_ylabel('Magnitude')
        ax.grid(True)

    axes[-1].set_xlabel('Time [s]')
    plt.tight_layout()

    # JPEGä¿å­˜ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã«ãƒšã‚¢ç•ªå·ã‚’å«ã‚ã‚‹ï¼‰
    outname = f'waveform_pair_{i}.jpg'
    plt.savefig(outname, format='jpeg', dpi=300)
    print(f"âœ… ä¿å­˜ã—ã¾ã—ãŸ: {outname}")
    plt.close()
